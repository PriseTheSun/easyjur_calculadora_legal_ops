<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora Legal Ops | Business Intelligence</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --legalops-primary: #3a36e0;
        --legalops-primary-light: #6c67ff;
        --legalops-primary-dark: #2a27b3;
        --legalops-secondary: #ff3b5f;
        --legalops-secondary-light: #ff7b95;
        --legalops-accent: #22c55e;
        --legalops-accent-light: #4ade80;
        --legalops-warning: #f59e0b;
        --legalops-warning-light: #fcd34d;
        --legalops-dark: #1e293b;
        --legalops-dark-light: #334155;
        --legalops-light: #f8fafc;
        --legalops-gray: #94a3b8;
        --legalops-gray-light: #e2e8f0;
        --legalops-radius: 16px;
        --legalops-radius-sm: 8px;
        --legalops-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        --legalops-shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
        --legalops-transition: all 0.3s ease;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Inter", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f0f4ff 0%, #e6e6ff 100%);
        color: var(--legalops-dark);
        line-height: 1.6;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .legalops-app-container {
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
      }

      /* Header moderno */
      .legalops-header {
        text-align: center;
        margin-bottom: 30px;
        position: relative;
      }

      .legalops-header-content {
        background: linear-gradient(
          145deg,
          var(--legalops-primary) 0%,
          var(--legalops-primary-dark) 100%
        );
        color: white;
        padding: 25px;
        border-radius: var(--legalops-radius);
        box-shadow: var(--legalops-shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .legalops-header::before {
        content: "";
        position: absolute;
        top: -20px;
        right: -20px;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: var(--legalops-secondary);
        opacity: 0.15;
        z-index: 0;
      }

      .legalops-logo {
        font-size: 32px;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
      }

      .legalops-title {
        margin-bottom: 8px;
        font-size: 28px;
        font-weight: 800;
        position: relative;
        z-index: 1;
      }

      .legalops-subtitle {
        font-size: 16px;
        font-weight: 400;
        opacity: 0.9;
        max-width: 500px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      /* Layout principal com BI */
      .legalops-main-content {
        display: grid;
        grid-template-columns: 1fr 1.4fr;
        gap: 24px;
        margin-bottom: 40px;
      }

      @media (max-width: 1100px) {
        .legalops-main-content {
          grid-template-columns: 1fr;
          gap: 20px;
        }
      }

      .legalops-card {
        background-color: white;
        border-radius: var(--legalops-radius);
        box-shadow: var(--legalops-shadow);
        overflow: hidden;
        transition: var(--legalops-transition);
      }

      .legalops-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--legalops-shadow-lg);
      }

      .legalops-card-header {
        background: linear-gradient(
          90deg,
          var(--legalops-dark) 0%,
          var(--legalops-dark-light) 100%
        );
        color: white;
        padding: 18px 24px;
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .legalops-card-body {
        padding: 24px;
      }

      /* Sistema de status/recomendação */
      .legalops-status-container {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }

      .legalops-status-tag {
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: 600;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .legalops-status-neutral {
        background-color: var(--legalops-gray-light);
        color: var(--legalops-dark-light);
      }

      .legalops-status-recommended {
        background-color: var(--legalops-accent-light);
        color: #166534;
      }

      .legalops-status-not-recommended {
        background-color: #fee2e2;
        color: #b91c1c;
      }

      /* Formulário compacto */
      .legalops-form-group {
        margin-bottom: 18px;
      }

      .legalops-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--legalops-dark);
        font-size: 14px;
      }

      .legalops-input-container {
        position: relative;
      }

      .legalops-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--legalops-gray-light);
        border-radius: var(--legalops-radius-sm);
        font-size: 14px;
        transition: var(--legalops-transition);
        background-color: var(--legalops-light);
      }

      .legalops-input:focus {
        border-color: var(--legalops-primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(58, 54, 224, 0.1);
      }

      .legalops-input-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--legalops-gray);
        font-size: 16px;
      }

      .legalops-input-with-icon {
        padding-left: 40px;
      }

      .legalops-info-text {
        font-size: 12px;
        color: var(--legalops-gray);
        margin-top: 4px;
        display: block;
      }

      .legalops-section-title {
        margin: 20px 0 15px;
        color: var(--legalops-dark);
        padding-bottom: 10px;
        border-bottom: 1px solid var(--legalops-gray-light);
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .legalops-btn {
        background: linear-gradient(
          to right,
          var(--legalops-primary),
          var(--legalops-primary-light)
        );
        color: white;
        border: none;
        padding: 14px 20px;
        border-radius: var(--legalops-radius-sm);
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        width: 100%;
        transition: var(--legalops-transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-top: 10px;
      }

      .legalops-btn:hover {
        opacity: 0.95;
        transform: translateY(-2px);
      }

      .legalops-info-box {
        background: linear-gradient(145deg, #fef3c7 0%, #fef9c3 100%);
        border-left: 4px solid var(--legalops-warning);
        padding: 14px;
        border-radius: var(--legalops-radius-sm);
        margin-top: 20px;
        font-size: 13px;
        display: flex;
        align-items: flex-start;
        gap: 10px;
      }

      .legalops-info-box i {
        color: var(--legalops-warning);
        font-size: 18px;
        flex-shrink: 0;
        margin-top: 2px;
      }

      /* Resultados com visual de BI */
      .legalops-results-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 20px;
      }

      .legalops-result-card {
        background: white;
        padding: 16px;
        border-radius: var(--legalops-radius-sm);
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--legalops-gray-light);
        transition: var(--legalops-transition);
        position: relative;
        overflow: hidden;
      }

      .legalops-result-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
      }

      .legalops-result-card.legalops-clt::before {
        background: var(--legalops-secondary);
      }

      .legalops-result-card.legalops-legalops::before {
        background: var(--legalops-primary);
      }

      .legalops-result-card.legalops-economy::before {
        background: var(--legalops-accent);
      }

      .legalops-result-card.legalops-roi::before {
        background: var(--legalops-warning);
      }

      .legalops-result-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      }

      .legalops-result-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--legalops-dark-light);
        font-size: 13px;
      }

      .legalops-result-value {
        font-size: 18px;
        font-weight: 700;
      }

      .legalops-clt-cost {
        color: var(--legalops-secondary);
      }

      .legalops-legalops-cost {
        color: var(--legalops-primary);
      }

      .legalops-positive {
        color: var(--legalops-accent);
      }

      .legalops-negative {
        color: var(--legalops-secondary);
      }

      /* Gráficos - Container */
      .legalops-charts-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .legalops-chart-wrapper {
        background: white;
        padding: 20px;
        border-radius: var(--legalops-radius-sm);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .legalops-chart-title {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--legalops-dark);
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        flex-wrap: wrap;
        line-height: 1.4;
        padding: 0 10px;
        width: 100%;
      }

      .legalops-chart-container {
        position: relative;
        height: 220px;
        width: 100%;
        margin: 0 auto;
      }

      .legalops-explanation {
        margin-top: 20px;
        padding: 18px;
        background: var(--legalops-light);
        border-radius: var(--legalops-radius-sm);
        font-size: 14px;
        line-height: 1.6;
      }

      .legalops-highlight {
        font-weight: 700;
      }

      /* Benefícios compactos */
      .legalops-benefits {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-top: 30px;
      }

      /* Responsividade */
      @media (max-width: 1100px) {
        .legalops-main-content {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .legalops-charts-container {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .legalops-charts-container {
          grid-template-columns: 1fr;
        }

        .legalops-chart-container {
          height: 200px;
        }

        .legalops-benefits {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 600px) {
        .legalops-benefits {
          grid-template-columns: 1fr;
        }

        .legalops-results-grid {
          grid-template-columns: 1fr;
        }

        .legalops-chart-container {
          height: 180px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .legalops-header-content {
          padding: 15px;
        }

        .legalops-title {
          font-size: 24px;
        }

        .legalops-subtitle {
          font-size: 14px;
        }

        .legalops-card-body {
          padding: 15px;
        }

        .legalops-card-header {
          font-size: 14px;
          padding: 15px 20px;
        }

        .legalops-chart-title {
          font-size: 12px;
        }

        .legalops-chart-container {
          height: 160px;
        }

        .legalops-result-title {
          font-size: 12px;
        }

        .legalops-result-value {
          font-size: 16px;
        }

        .legalops-form-group {
          margin-bottom: 15px;
        }

        .legalops-label {
          font-size: 13px;
        }

        .legalops-input {
          font-size: 13px;
        }

        .legalops-btn {
          font-size: 13px;
          padding: 12px 18px;
        }

        .legalops-info-box {
          font-size: 12px;
        }

        .legalops-explanation {
          font-size: 13px;
          padding: 15px;
        }
      }

      .legalops-benefit-card {
        background: white;
        padding: 20px;
        border-radius: var(--legalops-radius);
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--legalops-gray-light);
        transition: var(--legalops-transition);
      }

      .legalops-benefit-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      }

      .legalops-benefit-icon {
        font-size: 32px;
        color: var(--legalops-primary);
        margin-bottom: 12px;
      }

      .legalops-benefit-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--legalops-dark);
        font-size: 15px;
      }

      .legalops-benefit-card p {
        font-size: 13px;
        color: var(--legalops-dark-light);
      }

      /* Footer */
      .legalops-footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        color: var(--legalops-gray);
        font-size: 13px;
        border-top: 1px solid var(--legalops-gray-light);
      }

      /* Animações */
      @keyframes legalops-fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .legalops-card {
        animation: legalops-fadeIn 0.5s ease-out;
      }
    </style>
  </head>
  <body>
    <div class="legalops-app-container">
      <header class="legalops-header">
        <div class="legalops-header-content">
          <div class="legalops-logo">
            <i class="fas fa-balance-scale"></i>
          </div>
          <h1 class="legalops-title">Calculadora Legal Ops</h1>
          <p class="legalops-subtitle">
            Análise inteligente de economia com visualização avançada de dados
          </p>
        </div>
      </header>

      <div class="legalops-status-container">
        <div
          id="legalops-status-tag"
          class="legalops-status-tag legalops-status-neutral"
        >
          <i class="fas fa-info-circle"></i>
          <span>Preencha os dados para análise</span>
        </div>
      </div>

      <div class="legalops-main-content">
        <div class="legalops-card">
          <div class="legalops-card-header">
            <i class="fas fa-pencil-alt"></i>
            Dados da sua empresa
          </div>
          <div class="legalops-card-body">
            <div class="legalops-form-group">
              <label class="legalops-label" for="legalops-salario_base"
                >Salário médio do advogado interno (sem encargos)</label
              >
              <div class="legalops-input-container">
                <i class="legalops-input-icon fas fa-money-bill-wave"></i>
                <input
                  type="text"
                  id="legalops-salario_base"
                  class="legalops-input legalops-input-with-icon"
                  inputmode="decimal"
                  value="0,00"
                  placeholder="0,00"
                  data-max="20000"
                />
              </div>
              <span class="legalops-info-text">Valor máximo: R$ 20.000,00</span>
            </div>

            <div class="legalops-form-group">
              <label class="legalops-label" for="legalops-qtd_adv"
                >Número de advogados contratados (CLT)</label
              >
              <div class="legalops-input-container">
                <i class="legalops-input-icon fas fa-users"></i>
                <input
                  type="text"
                  id="legalops-qtd_adv"
                  class="legalops-input legalops-input-with-icon"
                  inputmode="numeric"
                  value="0"
                  placeholder="0"
                  data-max="100"
                />
              </div>
              <span class="legalops-info-text">Valor máximo: 100</span>
            </div>

            <h3 class="legalops-section-title">
              <i class="fas fa-chart-bar"></i> Volume mensal de demandas
            </h3>

            <div class="legalops-form-group">
              <label class="legalops-label" for="legalops-qtd_audiencias"
                >Audiências presenciais/online</label
              >
              <div class="legalops-input-container">
                <i class="legalops-input-icon fas fa-gavel"></i>
                <input
                  type="text"
                  id="legalops-qtd_audiencias"
                  class="legalops-input legalops-input-with-icon"
                  inputmode="numeric"
                  value="0"
                  placeholder="0"
                  data-max="10000"
                />
              </div>
              <span class="legalops-info-text">Valor máximo: 10.000</span>
            </div>

            <div class="legalops-form-group">
              <label class="legalops-label" for="legalops-qtd_diligencias"
                >Diligências</label
              >
              <div class="legalops-input-container">
                <i class="legalops-input-icon fas fa-search"></i>
                <input
                  type="text"
                  id="legalops-qtd_diligencias"
                  class="legalops-input legalops-input-with-icon"
                  inputmode="numeric"
                  value="0"
                  placeholder="0"
                  data-max="10000"
                />
              </div>
              <span class="legalops-info-text">Valor máximo: 10.000</span>
            </div>

            <div class="legalops-form-group">
              <label class="legalops-label" for="legalops-qtd_peticoes"
                >Petições (iniciais/contestações)</label
              >
              <div class="legalops-input-container">
                <i class="legalops-input-icon fas fa-file-contract"></i>
                <input
                  type="text"
                  id="legalops-qtd_peticoes"
                  class="legalops-input legalops-input-with-icon"
                  inputmode="numeric"
                  value="0"
                  placeholder="0"
                  data-max="10000"
                />
              </div>
              <span class="legalops-info-text">Valor máximo: 10.000</span>
            </div>

            <div class="legalops-form-group">
              <label class="legalops-label" for="legalops-qtd_publicacoes"
                >Publicações / Controladoria</label
              >
              <div class="legalops-input-container">
                <i class="legalops-input-icon fas fa-newspaper"></i>
                <input
                  type="text"
                  id="legalops-qtd_publicacoes"
                  class="legalops-input legalops-input-with-icon"
                  inputmode="numeric"
                  value="0"
                  placeholder="0"
                  data-max="10000"
                />
              </div>
              <span class="legalops-info-text">Valor máximo: 10.000</span>
            </div>

            <button id="legalops-calcular" class="legalops-btn">
              <i class="fas fa-calculator"></i> Calcular Economia
            </button>

            <div class="legalops-info-box">
              <i class="fas fa-info-circle"></i>
              <div>
                Os cálculos consideram encargos trabalhistas de 70% sobre o
                salário base e os valores por demanda seguem a tabela Legal Ops.
                Audiências: R$ 180,00 | Diligências: R$ 80,00 | Petições: R$
                120,00 | Publicações: R$ 3,00
              </div>
            </div>
          </div>
        </div>

        <div class="legalops-card">
          <div class="legalops-card-header">
            <i class="fas fa-chart-line"></i>
            Painel de Resultados
          </div>
          <div class="legalops-card-body">
            <div class="legalops-results-grid">
              <div class="legalops-result-card legalops-clt">
                <div class="legalops-result-title">
                  Custo atual com advogados CLT
                </div>
                <div
                  id="legalops-custo_clt"
                  class="legalops-result-value legalops-clt-cost"
                >
                  R$ 0,00
                </div>
              </div>

              <div class="legalops-result-card legalops-legalops">
                <div class="legalops-result-title">Custo com Legal Ops</div>
                <div
                  id="legalops-custo_legalops"
                  class="legalops-result-value legalops-legalops-cost"
                >
                  R$ 0,00
                </div>
              </div>

              <div class="legalops-result-card legalops-economy">
                <div class="legalops-result-title">Economia potencial</div>
                <div
                  id="legalops-economia"
                  class="legalops-result-value legalops-positive"
                >
                  R$ 0,00
                </div>
              </div>

              <div class="legalops-result-card legalops-roi">
                <div class="legalops-result-title">ROI da terceirização</div>
                <div id="legalops-roi" class="legalops-result-value">0%</div>
              </div>
            </div>

            <!-- Gráficos -->
            <div class="legalops-charts-container">
              <div class="legalops-chart-wrapper">
                <div class="legalops-chart-title">
                  <i class="fas fa-chart-bar"></i> Comparativo de Custos
                </div>
                <div class="legalops-chart-container">
                  <canvas id="legalops-costComparisonChart"></canvas>
                </div>
              </div>

              <div class="legalops-chart-wrapper">
                <div class="legalops-chart-title">
                  <i class="fas fa-chart-pie"></i> Distribuição de Custos Legal
                  Ops
                </div>
                <div class="legalops-chart-container">
                  <canvas id="legalops-costDistributionChart"></canvas>
                </div>
              </div>
            </div>

            <div id="legalops-mensagem" class="legalops-explanation">
              Preencha os dados ao lado para gerar uma análise completa da
              economia potencial com a Legal Ops.
            </div>
          </div>
        </div>
      </div>

      <div class="legalops-benefits">
        <div class="legalops-benefit-card">
          <div class="legalops-benefit-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="legalops-benefit-title">Redução de Riscos</div>
          <p>
            Eliminação de riscos trabalhistas e maior previsibilidade nos custos
          </p>
        </div>

        <div class="legalops-benefit-card">
          <div class="legalops-benefit-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="legalops-benefit-title">Economia de Tempo</div>
          <p>Liberação do time para atividades estratégicas de maior valor</p>
        </div>

        <div class="legalops-benefit-card">
          <div class="legalops-benefit-icon">
            <i class="fas fa-chart-pie"></i>
          </div>
          <div class="legalops-benefit-title">Previsibilidade</div>
          <p>
            Controle total sobre os custos jurídicos sem surpresas no final do
            mês
          </p>
        </div>
      </div>

      <footer class="legalops-footer">
        <p>
          © 2026 Legal Ops - Business Intelligence para Escritórios de Advocacia
        </p>
        <p>Os valores são estimativas com base nos inputs fornecidos.</p>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elementos do DOM
        const salarioBaseInput = document.getElementById(
          "legalops-salario_base"
        );
        const qtdAdvInput = document.getElementById("legalops-qtd_adv");
        const qtdAudienciasInput = document.getElementById(
          "legalops-qtd_audiencias"
        );
        const qtdDiligenciasInput = document.getElementById(
          "legalops-qtd_diligencias"
        );
        const qtdPeticoesInput = document.getElementById(
          "legalops-qtd_peticoes"
        );
        const qtdPublicacoesInput = document.getElementById(
          "legalops-qtd_publicacoes"
        );
        const calcularBtn = document.getElementById("legalops-calcular");
        const statusTag = document.getElementById("legalops-status-tag");

        const custoCltElem = document.getElementById("legalops-custo_clt");
        const custoLegalOpsElem = document.getElementById(
          "legalops-custo_legalops"
        );
        const economiaElem = document.getElementById("legalops-economia");
        const roiElem = document.getElementById("legalops-roi");
        const mensagemElem = document.getElementById("legalops-mensagem");

        // Variáveis para os gráficos
        let costComparisonChart = null;
        let costDistributionChart = null;

        // Função para formatar números com separadores de milhares
        function formatarNumero(valor, isCurrency = false) {
          if (isCurrency) {
            return new Intl.NumberFormat("pt-BR", {
              style: "currency",
              currency: "BRL",
            }).format(valor);
          }
          return new Intl.NumberFormat("pt-BR").format(valor);
        }

        // Função para remover formatação e converter para número
        function desformatarNumero(valorFormatado) {
          if (!valorFormatado) return 0;
          // Remove todos os caracteres não numéricos, exceto vírgula e ponto
          let valor = valorFormatado.replace(/[^\d,.]/g, "");
          // Substitui ponto por nada (separador de milhar) e vírgula por ponto
          valor = valor.replace(/\./g, "").replace(",", ".");
          // Converte para float
          return parseFloat(valor) || 0;
        }

        // Função para formatar input em tempo real
        function formatarInput(event) {
          const input = event.target;
          let valor = input.value.replace(/[^\d,]/g, ""); // Mantém apenas números e vírgula

          if (input.id === "legalops-salario_base") {
            // Se estiver vazio, definir como 0
            if (valor === "") {
              input.value = "0,00";
              return;
            }

            // Substitui múltiplas vírgulas por uma única vírgula
            valor = valor.replace(/,+/g, ",");

            // Divide em parte inteira e decimal
            let [inteiro, decimal] = valor.split(",");

            // Garante que a parte decimal tenha no máximo 2 dígitos
            decimal = (decimal || "").padEnd(2, "0").slice(0, 2);

            // Formata a parte inteira com pontos
            inteiro = (inteiro || "0").replace(/\B(?=(\d{3})+(?!\d))/g, ".");

            // Compõe o valor formatado
            input.value = inteiro + "," + decimal;
          } else {
            // Para outros campos (apenas números inteiros)
            if (valor === "") {
              input.value = "0";
            } else {
              // Remove vírgulas para números inteiros
              valor = valor.replace(/,/g, "");
              // Formatar com separadores de milhar
              input.value = new Intl.NumberFormat("pt-BR").format(
                parseInt(valor) || 0
              );
            }
          }
        }

        // Função para validar valor máximo
        function validarValorMaximo(input) {
          const max = parseFloat(input.getAttribute("data-max")) || 0;
          if (max === 0) return;

          let valorAtual;

          if (input.id === "legalops-salario_base") {
            valorAtual = desformatarNumero(input.value);
          } else {
            valorAtual = parseInt(input.value.replace(/\D/g, "") || 0);
          }

          if (valorAtual > max) {
            if (input.id === "legalops-salario_base") {
              input.value = new Intl.NumberFormat("pt-BR", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              }).format(max);
            } else {
              input.value = new Intl.NumberFormat("pt-BR").format(max);
            }
          }
        }

        // Função para lidar com a entrada de dados no campo de salário
        function handleSalarioInput(e) {
          // Permitir números, vírgula e teclas de controle
          if (
            !/[\d,]/.test(e.key) &&
            !["Backspace", "Delete", "ArrowLeft", "ArrowRight", "Tab"].includes(
              e.key
            )
          ) {
            e.preventDefault();
            return;
          }

          // Evitar múltiplas vírgulas
          if (e.key === "," && this.value.includes(",")) {
            e.preventDefault();
            return;
          }
        }

        // Função para lidar com a entrada de dados nos campos numéricos
        function handleNumericInput(e) {
          // Permitir apenas números e teclas de controle
          if (
            !/\d/.test(e.key) &&
            !["Backspace", "Delete", "ArrowLeft", "ArrowRight", "Tab"].includes(
              e.key
            )
          ) {
            e.preventDefault();
            return;
          }
        }

        // Função para atualizar o status de recomendação
        function atualizarStatus(economia, roi) {
          statusTag.classList.remove(
            "legalops-status-neutral",
            "legalops-status-recommended",
            "legalops-status-not-recommended"
          );

          if (economia === 0) {
            statusTag.className = "legalops-status-tag legalops-status-neutral";
            statusTag.innerHTML =
              '<i class="fas fa-info-circle"></i><span>Preencha os dados para análise</span>';
          } else if (economia > 0 && roi >= 20) {
            statusTag.className =
              "legalops-status-tag legalops-status-recommended";
            statusTag.innerHTML =
              '<i class="fas fa-check-circle"></i><span>Legal Ops recomendado! Economia significativa</span>';
          } else if (economia > 0) {
            statusTag.className =
              "legalops-status-tag legalops-status-recommended";
            statusTag.innerHTML =
              '<i class="fas fa-thumbs-up"></i><span>Legal Ops recomendado</span>';
          } else {
            statusTag.className =
              "legalops-status-tag legalops-status-not-recommended";
            statusTag.innerHTML =
              '<i class="fas fa-exclamation-circle"></i><span>Legal Ops não recomendado no momento</span>';
          }
        }

        // Função para atualizar os gráficos
        function atualizarGraficos(
          custoTotalClt,
          custoLegalOps,
          custoAudiencias,
          custoDiligencias,
          custoPeticoes,
          custoPublicacoes
        ) {
          if (costComparisonChart) {
            costComparisonChart.destroy();
          }
          if (costDistributionChart) {
            costDistributionChart.destroy();
          }

          // Gráfico de comparação de custos
          const costCtx = document
            .getElementById("legalops-costComparisonChart")
            .getContext("2d");
          costComparisonChart = new Chart(costCtx, {
            type: "bar",
            data: {
              labels: ["Custo CLT", "Custo Legal Ops"],
              datasets: [
                {
                  label: "Valores em R$",
                  data: [custoTotalClt, custoLegalOps],
                  backgroundColor: [
                    "rgba(255, 59, 95, 0.7)",
                    "rgba(58, 54, 224, 0.7)",
                  ],
                  borderColor: ["rgb(255, 59, 95)", "rgb(58, 54, 224)"],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      let value = context.parsed.y;
                      return (
                        context.label +
                        ": " +
                        new Intl.NumberFormat("pt-BR", {
                          style: "currency",
                          currency: "BRL",
                        }).format(value)
                      );
                    },
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value) {
                      return "R$ " + value.toLocaleString("pt-BR");
                    },
                  },
                },
              },
            },
          });

          // Gráfico de distribuição de custos
          const distributionCtx = document
            .getElementById("legalops-costDistributionChart")
            .getContext("2d");
          costDistributionChart = new Chart(distributionCtx, {
            type: "doughnut",
            data: {
              labels: ["Audiências", "Diligências", "Petições", "Publicações"],
              datasets: [
                {
                  data: [
                    custoAudiencias,
                    custoDiligencias,
                    custoPeticoes,
                    custoPublicacoes,
                  ],
                  backgroundColor: [
                    "rgba(58, 54, 224, 0.7)",
                    "rgba(255, 59, 95, 0.7)",
                    "rgba(34, 197, 94, 0.7)",
                    "rgba(245, 158, 11, 0.7)",
                  ],
                  borderColor: [
                    "rgb(58, 54, 224)",
                    "rgb(255, 59, 95)",
                    "rgb(34, 197, 94)",
                    "rgb(245, 158, 11)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "bottom",
                  labels: {
                    padding: 15,
                    boxWidth: 12,
                    font: {
                      size: 12,
                    },
                  },
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      let value = context.parsed;
                      return (
                        context.label +
                        ": " +
                        new Intl.NumberFormat("pt-BR", {
                          style: "currency",
                          currency: "BRL",
                        }).format(value)
                      );
                    },
                  },
                },
              },
            },
          });
        }

        // Função para calcular os resultados
        function calcular() {
          // Obter valores dos inputs
          const salarioBase = desformatarNumero(salarioBaseInput.value) || 0;
          const qtdAdv = parseInt(qtdAdvInput.value.replace(/\D/g, "") || 0);
          const qtdAudiencias = parseInt(
            qtdAudienciasInput.value.replace(/\D/g, "") || 0
          );
          const qtdDiligencias = parseInt(
            qtdDiligenciasInput.value.replace(/\D/g, "") || 0
          );
          const qtdPeticoes = parseInt(
            qtdPeticoesInput.value.replace(/\D/g, "") || 0
          );
          const qtdPublicacoes = parseInt(
            qtdPublicacoesInput.value.replace(/\D/g, "") || 0
          );

          // Calcular custo CLT
          const custoTotalClt = salarioBase * 1.7 * qtdAdv;

          // Calcular custos por tipo de demanda
          const custoAudiencias = qtdAudiencias * 180;
          const custoDiligencias = qtdDiligencias * 80;
          const custoPeticoes = qtdPeticoes * 120;
          const custoPublicacoes = qtdPublicacoes * 3;

          // Calcular custo total Legal Ops
          const custoLegalOps =
            custoAudiencias +
            custoDiligencias +
            custoPeticoes +
            custoPublicacoes;

          // Calcular economia e ROI
          const economia = custoTotalClt - custoLegalOps;
          let roi = custoLegalOps > 0 ? (economia / custoLegalOps) * 100 : 0;

          // Formatar ROI para exibição
          let roiDisplay = roi > 100 ? "+ de 100%" : `${roi.toFixed(0)}%`;

          // Atualizar a interface
          custoCltElem.textContent = formatarNumero(custoTotalClt, true);
          custoLegalOpsElem.textContent = formatarNumero(custoLegalOps, true);
          economiaElem.textContent = formatarNumero(economia, true);
          roiElem.textContent = roiDisplay;

          // Atualizar status de recomendação
          atualizarStatus(economia, roi);

          // Atualizar gráficos
          atualizarGraficos(
            custoTotalClt,
            custoLegalOps,
            custoAudiencias,
            custoDiligencias,
            custoPeticoes,
            custoPublicacoes
          );

          // Atualizar classes para positivo/negativo
          if (economia > 0) {
            economiaElem.classList.remove("legalops-negative");
            economiaElem.classList.add("legalops-positive");
            roiElem.classList.remove("legalops-negative");
            roiElem.classList.add("legalops-positive");
          } else {
            economiaElem.classList.remove("legalops-positive");
            economiaElem.classList.add("legalops-negative");
            roiElem.classList.remove("legalops-positive");
            roiElem.classList.add("legalops-negative");
          }

          // Gerar mensagem explicativa
          if (custoTotalClt === 0 && custoLegalOps === 0) {
            mensagemElem.innerHTML =
              "Preencha os dados ao lado para calcular a economia potencial com a Legal Ops.";
          } else if (economia > 0) {
            mensagemElem.innerHTML = `
                        <p>Hoje, com advogados CLT, seu custo fixo mensal com encargos trabalhistas é de aproximadamente <span class="legalops-highlight">${formatarNumero(
                          custoTotalClt,
                          true
                        )}</span>.</p>
                        <p>Com a Legal Ops, o mesmo volume de demandas sairia por <span class="legalops-highlight">${formatarNumero(
                          custoLegalOps,
                          true
                        )}</span>, 
                        gerando uma economia de <span class="legalops-highlight legalops-positive">${formatarNumero(
                          economia,
                          true
                        )}/mês</span> e um ROI de <span class="legalops-highlight legalops-positive">${roiDisplay}</span>.</p>
                        <p>Isso significa reduzir despesas, ter previsibilidade financeira e liberar sua equipe para atividades estratégicas.</p>
                        <p>Fale com nosso consultor e faça uma simulação personalizada para a realidade atual do seu escritório.</p>
                    `;
          } else {
            mensagemElem.innerHTML = `
                        <p>Neste caso, terceirizar via Legal Ops custaria <span class="legalops-highlight">${formatarNumero(
                          custoLegalOps,
                          true
                        )}/mês</span>, 
                        enquanto manter advogados CLT sairia por <span class="legalops-highlight">${formatarNumero(
                          custoTotalClt,
                          true
                        )}/mês</span>.</p>
                        <p><strong>Legal Ops não é recomendado para seu perfil atual</strong>, pois resultaria em um custo adicional de <span class="legalops-highlight legalops-negative">${formatarNumero(
                          -economia,
                          true
                        )}/mês</span>.</p>
                        <p>Mesmo assim, manter funcionários internos envolve custos e riscos adicionais, como demissões, substituições, treinamentos e erros que geram retrabalho.</p>
                        <p>Recomendamos uma avaliação personalizada com nosso consultor para analisar alternativas.</p>
                    `;
          }
        }

        // Configurar event listeners para os inputs
        const inputs = document.querySelectorAll(
          'input[inputmode="numeric"], input[inputmode="decimal"]'
        );
        inputs.forEach((input) => {
          // Formatar e validar no blur
          input.addEventListener("blur", (event) => {
            formatarInput(event);
            validarValorMaximo(input);
          });

          // Adicionar validação de entrada de teclado
          if (input.id === "legalops-salario_base") {
            input.addEventListener("keydown", handleSalarioInput);
          } else {
            input.addEventListener("keydown", handleNumericInput);
            input.addEventListener("input", formatarInput);
          }
        });

        // Event listeners para o botão calcular
        calcularBtn.addEventListener("click", calcular);

        // Calcular automaticamente quando qualquer input mudar
        inputs.forEach((input) => {
          input.addEventListener("input", calcular);
        });

        // Formatar os valores iniciais
        inputs.forEach((input) => {
          const event = { target: input };
          formatarInput(event);
        });

        // Calcular inicialmente
        calcular();
      });
    </script>
  </body>
</html>
